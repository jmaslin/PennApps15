<!DOCTYPE html>

<html lang="en">
	<head>
		<title>Trip</title>
		<!-- CSS -->
		<link href="/public/components/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" media="screen">

		<link href="/public/trip.css" rel="stylesheet" media="screen">
		<link href="/public/map.css" rel="stylesheet" media="screen">

		<!-- JS -->
		<script src="/public/components/jquery/dist/jquery.js"></script>
		<script src="/public/components/bootstrap/dist/js/bootstrap.js"></script>

		<!-- Full Calendar -->
		<script src="/public/components/moment/min/moment.min.js"></script>
<!-- 		<script src="/public/components/fullcalendar/dist/fullcalendar.min.js"></script>
		<link href="/public/components/fullcalendar/dist/fullcalendar.min.css" rel="stylesheet" media="screen"> -->

		<!-- PickADate -->
		<script src="/public/components/pickadate/lib/picker.js"></script>
		<script src="/public/components/pickadate/lib/picker.date.js"></script>
		<script src="/public/components/pickadate/lib/picker.time.js"></script>
		<!-- <script src="/public/components/pickadate/lib/legacy.js"></script> -->

		<link href="/public/components/pickadate/lib/themes/classic.css" rel="stylesheet" media="screen"></script>
		<link href="/public/components/pickadate/lib/themes/classic.date.css" rel="stylesheet" media="screen"></script>
		<link href="/public/components/pickadate/lib/themes/classic.time.css" rel="stylesheet" media="screen"></script>
<!-- 
		<script type="text/javascript"
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDYciGKuGqG10zrJs4ZrTWkHVkd0nhMu6k">
    </script>
 -->
   	<script src="/public/components/sticky/jquery.sticky.js"></script>

   	<script src="http://maps.google.com/maps/api/js?sensor=true"></script>
   	<script src="/public/components/gmaps/gmaps.js"></script>

		<meta http-equiv="X-UA-Compatible" content="IE=edge"> 
	</head>
	<body>

<!-- 		<div id="overlayContainer" class="container-fluid">
			<div class="row">
				<div class="col-sm-8 col-sm-offset-4">
					<h1>OVERLAY TESTING</h1>
				</div>
			</div>
		</div> -->

		<div id="pageMain" class="container-fluid">
			<!-- TOP START -->

			<!-- TOP END -->

			<!-- BODY START -->
			<div class="row">

				<!-- SIDE START -->
				<div id="tripSide" class="col-sm-4">

					<div id="top" class="row">
						<div class="col-sm-12">
							<h2>
								<span id="beginMessage">Have fun on your trip to </span>
								<span class="text-primary" id="tripDestination">New York City</span>!
							</h2>
							<p class="lead">
								<span id="startTextDates">You leave on</span>  
								<!-- <button type="button" class="btn btn-info" data-container="body" data-toggle="popover" data-placement="bottom" data-trigger="manual" title="Calendar"> --><span id="tripFromDate" class="text-info">Friday, January 20th 2015</span><!-- </button> -->
								<span id="midTextDates">and return</span> 
								<!-- <button type="button" class="btn btn-info" data-container="body" data-toggle="popover" data-placement="bottom" data-trigger="manual" title="Calendar"> --><span id="tripToDate" class="text-info">Sunday, January 27th 2015</span><!-- </button> -->.
							</p>
							<!-- <a href="/"><button type="button" class="btn btn-sm btn-info">Back</button></a> -->
						</div>
					</div>

					<div id="tripSideTop" class="row">
						<div class="col-sm-12">
							<h3><strong>Trip Itinerary</strong>	</h3>
								<button id="calViewBtn" class="btn btn-sm btn-info">Calendar View</button>
								<button data-toggle="modal" href="#editTripModal" class="btn btn-sm btn-warning">Edit Trip Details</button>
						
						</div>
					</div>

					
				</div>
				<!-- SIDE END -->

				<!-- MAIN START -->
				<div id="tripBody" class="col-sm-8 col-sm-offset-4">
					<div id="tripBodyTop" class="row">
						<ul class="nav nav-pills">
							<li role="presentation" class="active"><a href="#view">Overview</a></li>
							<!-- <li role="presentation" class="active"><a href="#view">Overview</a></li> -->
							<!-- <li role="presentation"><a data-toggle="modal" href="#editTripModal">Edit Mode</a></li> -->
						</ul>	
					</div>
					<div id="tripMap" class="row">
						<div id="map-canvas"></div>
						<!-- <img src="/public/bigmap-example.jpg"> -->

					</div>
					<!-- </div> -->
				</div>
				<!-- MAIN END -->
			</div>
			<!-- BODY END -->

		</div>

		<!-- EDIT TRIP MODAL -->
		<div class="modal fade" id="editTripModal" tabindex="-1" role="dialog" aria-labelledby="editTrip" aria-hidden="true">
		  <div class="modal-dialog modal-lg">
		    <div class="modal-content">
		      <div class="modal-header">
		        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
		        <h4 class="modal-title" id="myModalLabel">Edit Trip</h4>
		      </div>
		      <div class="modal-body">
		      	<h3>Change your <span class="text-primary">timeline</span>.</h3>
			      <form id="tripDays" class="form">
			      	<div class="row">
				      	<div class="col-sm-6">
				      		<div class="form-group">
				      			<input id="startDate" type="text" class="form-control input-lg" placeholder="Modify Start" autocomplete="off">
				      		</div>
				      	</div>
				      	<div class="col-sm-6">
				      		<div class="form-group">
				      			<input id="endDate" type="text" class="form-control input-lg" placeholder="Modify End" autocomplete="off">
				      		</div>
			      		</div>
			      		<div id="modalButtons" class="col-sm-2">
				      		<!-- <button type="button" id="saveDates" class="btn btn-success btn-lg">Save</button> -->
				      	</div>
			      	</div>	      	
			      	<!-- <p class="lead">Your trip is <span id="tripLength"></span> days long!</p> -->
			      </form>
			 			<div class="row">
			      	<hr>
			      </div>
			      <h3>Change a <span class="text-primary">waypoint</span>.</h3>
			      <form id="tripLoc" class="form">
			      	<div class="row">
			      		<div class="col-sm-6">
			      			<div class="form-group">
			      				<input id="startLoc" type="text" class="form-control input-lg" placeholder="Start Location">
			      			</div>
			      		</div>
			      		<div class="col-sm-6">
			      			<div class="form-group">
			      				<input id="endLoc" type="text" class="form-control input-lg" placeholder="End Location">
			      			</div>
			      		</div>
			      	</div>
			      </form>
			      <div class="row">
			      	<div class="col-sm-10 col-sm-offset-1">
			      	</div>
		      	</div>
		      </div>
		      <div class="modal-footer">
		        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
		        <button type="button" class="btn btn-primary">Save Trip</button>
		      </div>
		    </div>
		  </div>
		</div>
		<!-- EDIT TRIP MODAL END -->

	</body>
</html>
<!-- 
<script type="text/javascript">

	function initialize() {
	  
	  var mapOptions = {
	    center: { lat: -34.397, lng: 150.644},
	    zoom: 8,
	    disableDefaultUI: true
	  };
	  var map = new google.maps.Map(document.getElementById('map-canvas'),
	      mapOptions);

	}

	google.maps.event.addDomListener(window, 'load', initialize);

	console.log("Init map.");
</script>
 -->

<script type="text/javascript">

	// VARIABLE DECLARE

	var startDate = 1421712000; // Same as IDs of edit form.
	var endDate 	= 1422144000;

	var inputClicked;

	// EDIT CALENDAR
	// $('#calendar').fullCalendar({
 //  	dayClick: function(date, jsEvent, view) {

 //  		formatDate = String(date.format('dddd, MMM Do YYYY'));
 //  		$('#'+inputClicked).attr('placeholder', formatDate);

 //  		// TODO: Hidden form fields that save date formatted in YYYY-MM-DD.
 //  	},
 //  	// selectable: true,
 //  	// select: function(start, end, jsEvent, view) {
 //  	// 	console.log("Test :"+ start.format()+" "+end.format());
 //  	// },
 //  	events: [
 //  		{
 //  			title : 	'Trip Starts',
 //  			start : 	startDate
 //  		},
 //   		{
 //  			title : 	'Trip Ends',
 //  			start : 	endDate
 //  		}
 //  	]
 // 	});
   var map = new GMaps({
      el: '#map-canvas',
      lat: 39.958359,
      lng: -75.195393,
      zoom: 10
    });

	// DOCUMENT READY
	$( document ).ready(function() {

		$('#tripMap').hide();
		$('#tripMap').fadeIn('slow');


		getItinerary();
   	// $('#calendar').fullCalendar('render');

   	// $('#tripMap').sticky({topSpacing: 250});


		console.log("Hey you be ready to go trippin'");
	});

	$('form#tripDays input#startDate').on('click', function() {
		console.log($(this).attr('id'));
		$(this).pickadate({
			format: 'Starts On: dddd, dd mmm, yyyy',
			formatSubmit: 'yyyy-mm-dd',
			// hiddenName: true,
			// container: 'body'
		});
				console.log($('#startDate').attr('placeholder'))
	});
	$('form#tripDays input#endDate').on('click', function() {
		console.log($(this).attr('id'));
		$(this).pickadate({
			format: 'En!ds On: dddd, dd mmm, yyyy',
			formatSubmit: 'yyyy-mm-dd',
			// hiddenName: true,
			min: $('#startDate').val()
			// container: 'body'
		});
				console.log($('#startDate').attr('placeholder'))

	});


	// EDIT TRIP MODAL
	$('#editTripModal').on('shown.bs.modal', function () {

		$('#startDate').attr('placeholder', moment(startDate, 'X').format("dddd, MMMM DDDo, YYYY"));
		$('#endDate').attr('placeholder', moment(endDate, 'X').format("dddd, MMMM DDDo, YYYY"));
	;

	});

	$('form#tripDay input').on('focus', function() {
		$('.datepicker').pickadate();
	});

	// $('#editDates').on('click', function() {
	// 	$('#calendar').slideDown(function() {
 //  	 	$(this).fullCalendar('render');			
	// 	});
	// 	$('#editDates').slideUp('fast', function() {
	// 		$('#saveDates').slideDown('fast');
	// 		$('form .form-group').fadeToggle();
	// 	})
	// });
	// $('#saveDates').on('click', function() {
	// 	$('#calendar').slideUp('fast');
	// 	$('#saveDates').slideUp('fast', function() {
	// 		$('#editDates').slideDown('fast');
	// 		$('form .form-group').fadeToggle();
	// 	})
	// });

	$('form#datesForm input').on('focus', function() {
		console.log($(this).attr('id'));
		inputClicked = $(this).attr('id');
	});

	// $( window ).scroll(function() {
	// 	if ( $(this).scrollTop() >= 114) {
	// 		$('#sideTitle').addClass('fixed');
	// 	}
	// 	else {
	// 		$('#sideTitle').removeClass('fixed');
	// 	}
	// 	// console.log($(this).scrollTop());
	// });

	function generateEvents() {

	}

	// TODO: MAKE A TOGGLE BUTTON FOR WHEN DAY EVENTS HIDDEN THAT ONLY SHOWS WHRN HIDDEN (IN THAT EMPTY SPACE)

	function getItinerary() {

		var tripDay = 0;

		$.ajax({
			dataType: 'json',
			url: '/public/testdata.json',
			success: function(data) {
				var eventArray = data;
				$.each(eventArray, function(eventIndex, eventData) {
					

					var date = moment(eventData.time.arrive, 'X').format("dddd, MMMM DDDo, YYYY");
					console.log(eventIndex+" "+date);
					if (eventIndex > 0) {
						if (moment(eventData.time.arrive).isAfter(data[eventIndex-1].time.arrive)) {
							tripDay++;

							var newTripDay = 
								'<div id="'+tripDay+'" class="row tripDay col-sm-12">'+
									'<hr><button type="button" class="btn btn-primary tripDayTitle">'+date+'</button><hr>'+
								'</div>';	
							$('#tripSide').append(newTripDay);
						}
					}
					else {
						var newTripDay = 
							'<div id="'+tripDay+'" class="row tripDay col-sm-12">'+
								'<hr><button type="button" class="btn btn-primary tripDayTitle">'+date+'</button><hr>'+
							'</div>';				
						$('#tripSide').append(newTripDay);
					}

					time = moment(eventData.time.arrive).format("hh:mma");

					var eventModule =
					'<div class="tripModule row day'+tripDay+'Module" data-tripDay="'+tripDay+'">' +
						'<img class="img img-responsive tripModuleImg" src="'+eventData.image+'">' +
						'<div class="row">' +
							'<div class="tripModuleInfo col-sm-9">' +
								'<h3><strong><span id="tripModuleTitle">'+eventData.title+'</span></strong></h3>' +
								'<div class="tripModuleBadges">' +
									'<button class="btn btn-info">Rating: <span class="badge" id="tripModuleQuality">'+eventData.quality+'</span> </button> ' +
									'<button class="btn btn-success">Price: <span class="badge" id="tripModuleCost">'+eventData.cost+'</span> </button>' +
								'</div>' +
								'<p class="lead">Estimated Arrival: <samp>'+time+'</samp></p>' +
							'</div>' +
							'<div class="col-sm-2 col-sm-offset-1">' +
								'<a class="editModule" href="#"><img class="tripModuleClickImg img img-responsive" src="/public/img/icon/settings.png"></a>'+
								'<a class="aboutModule" href="#"><img class="tripModuleClickImg img img-responsive" src="/public/img/icon/info.png"></a>' +
							'</div>'+
						'</div>' +
					'</div>';
						
					$('#tripSide .tripDay:last').append(eventModule);

					map.addMarker({
					  lat: eventData.location.lat,
					  lng: eventData.location.lng,
					  title: eventData.title,
					  click: function(e) {
					  	// TODO: NICE MODAL SHOWING INFO.
					  }
					});

						// console.log(eventModule);
					$('#tripSide').trigger("Updated Itinerary");

 					// console.log( eventIndex + ": " + eventData.title );
				});

			}
		});
	}

	$('#tripSide').on('click', '.tripDayTitle', function() {

		$(this).parent().find('.tripModule').slideToggle('fast');
		console.log("Hi");
	});

	// $('a .editModule').on({
	// 	mouseenter: function() {
	// 		$(this).fadeTo(500, 1);
	// 		console.log("TEST");
	// 	},
	// 	mouseleave: function() {
	// 		$(this).fadeTo(500, 0.5);
	// 	}
	// }, 'img');

</script>

<!-- TODO: As scroll through, highlight certain days and its events (Ie, scrolling through the trip) -->

<!-- Incase forget, for each day item, have picture stretch width, display info at bottom like wide tile, but looks good. -->